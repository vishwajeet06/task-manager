<header class="page-header">
  <h1>Dashboard</h1>
</header>
<div
  *ngIf="loading$ | async; else dashboardContent"
  class="loading"
  aria-live="polite"
>
  <p>Loading tasks...</p>
</div>
<ng-template #dashboardContent>
  <div *ngIf="error$ | async as error" class="error-message" role="alert">
    <p>Error: {{ error }}</p>
    <button
      mat-raised-button
      color="primary"
      (click)="retryLoading()"
      aria-label="Retry loading data"
    >
      Retry
    </button>
  </div>
  <div class="metrics">
    <div class="metric-card total">
      <h3>Total Tasks</h3>
      <p>{{ totalTasks$ | async }}</p>
    </div>
    <div class="metric-card completed">
      <h3>Completed Tasks</h3>
      <p>{{ completedTasks$ | async }}</p>
    </div>
    <div class="metric-card overdue">
      <h3>Overdue Tasks</h3>
      <p>{{ overdueTasks$ | async }}</p>
    </div>
  </div>
  <div class="charts">
    <div class="chart-card">
      <h2>Tasks by Status</h2>
      <canvas
        baseChart
        [data]="statusChartData"
        [type]="statusChartType"
        [options]="chartOptions"
        aria-label="Chart of tasks by status"
      ></canvas>
    </div>
    <div class="chart-card">
      <h2>Tasks by Priority</h2>
      <canvas
        baseChart
        [data]="priorityChartData"
        [type]="priorityChartType"
        [options]="chartOptions"
        aria-label="Chart of tasks by priority"
      ></canvas>
    </div>
  </div>
  <div class="timeline">
    <h2>Recent Activity</h2>
    <div *ngIf="error$ | async as error" class="error-message" role="alert">
      <p>Error logging activity: {{ error }}</p>
      <button
        mat-raised-button
        color="primary"
        (click)="retryLoading()"
        aria-label="Retry loading activity"
      >
        Retry
      </button>
    </div>
    <div *ngIf="(activities$ | async)?.length === 0" class="no-activity">
      <p>No recent activity.</p>
    </div>
    <div class="activity-container">
      <div *ngFor="let activity of activities$ | async" class="activity-item">
        <mat-icon [ngClass]="getIconClass(activity.action)">
          {{ getIcon(activity.action) }}
        </mat-icon>
        <div class="activity-content">
          <span class="timestamp">{{
            activity.timestamp | date : "medium"
          }}</span>
          <span class="message" [innerHTML]="activity.details"></span>
        </div>
      </div>
    </div>
  </div>
</ng-template>
