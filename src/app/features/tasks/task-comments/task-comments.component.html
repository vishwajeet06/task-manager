<div class="comments-section">
  <div class="comments-header">
    <h3>Comments</h3>
    <span class="comment-count">
      {{ (comments$ | async)?.length || 0 }}
      {{ (comments$ | async)?.length === 1 ? "Comment" : "Comments" }}
    </span>
  </div>

  <div class="comments-container">
    <!-- Comment Cards -->
    <mat-card
      *ngFor="let comment of comments$ | async"
      class="comment-card"
      (mouseover)="hoveredComment = comment"
      (mouseleave)="hoveredComment = null"
    >
      <mat-card-header>
        <div
          mat-card-avatar
          class="comment-avatar"
          [style.background-color]="getAvatarColor(comment.userName)"
        >
          {{ comment.userName?.charAt(0)?.toUpperCase() || "A" }}
        </div>
        <div class="header-content">
          <mat-card-title class="comment-author">{{
            comment.userName || "Anonymous"
          }}</mat-card-title>
          <mat-card-subtitle class="comment-time">{{
            comment.timestamp | date : "medium"
          }}</mat-card-subtitle>
        </div>
        <mat-card-actions
          class="comment-actions"
          *ngIf="hoveredComment === comment || canEditComment(comment)"
        >
          <button
            mat-icon-button
            class="action-btn edit-btn"
            (click)="editComment(comment)"
            *ngIf="canEditComment(comment)"
            matTooltip="Edit"
          >
            <mat-icon>edit</mat-icon>
          </button>
          <button
            mat-icon-button
            class="action-btn delete-btn"
            (click)="deleteComment(comment.id)"
            *ngIf="canEditComment(comment)"
            matTooltip="Delete"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </mat-card-actions>
      </mat-card-header>

      <mat-card-content class="comment-content">
        <p class="comment-text" [innerHTML]="comment.text"></p>
      </mat-card-content>
    </mat-card>

    <!-- Empty State -->
    <div *ngIf="(comments$ | async)?.length === 0" class="no-comments">
      <mat-icon class="empty-icon">forum</mat-icon>
      <p>No comments yet. Be the first to share your thoughts!</p>
    </div>
  </div>

  <div class="comment-input-container">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Add a comment...</mat-label>
      <textarea
        matInput
        [(ngModel)]="newComment"
        #commentInput
        [rows]="3"
        cdkTextareaAutosize
      ></textarea>
    </mat-form-field>
    <div class="button-container">
      <button
        mat-flat-button
        color="primary"
        (click)="onPostComment()"
        [disabled]="!newComment.trim()"
        class="post-button"
      >
        <span class="button-content">
          <mat-icon class="button-icon">send</mat-icon>
          <span class="button-text">Post</span>
        </span>
      </button>
    </div>
  </div>
</div>
