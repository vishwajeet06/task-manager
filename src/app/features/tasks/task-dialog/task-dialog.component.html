<div class="main1">
  <h2 mat-dialog-title>{{ data ? "Edit Task" : "Add Task" }}</h2>
  <mat-dialog-content>
    <form #taskForm="ngForm">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Title</mat-label>
        <input
          matInput
          [(ngModel)]="task.title"
          name="title"
          required
          aria-label="Task title"
        />
      </mat-form-field>
      <div class="custom-form-field">
        <mat-label>Description</mat-label>
        <quill-editor
          [(ngModel)]="task.description"
          name="description"
          [required]="true"
          [modules]="quillConfig"
          aria-label="Task description"
        ></quill-editor>
      </div>
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Priority</mat-label>
        <mat-select
          [(ngModel)]="task.priority"
          name="priority"
          required
          aria-label="Task priority"
        >
          <mat-option value="Low">Low</mat-option>
          <mat-option value="Medium">Medium</mat-option>
          <mat-option value="High">High</mat-option>
          <mat-option value="Critical">Critical</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Due Date</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          [(ngModel)]="dueDate"
          name="dueDate"
          required
          aria-label="Task due date"
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Status</mat-label>
        <mat-select
          [(ngModel)]="task.status"
          name="status"
          required
          aria-label="Task status"
        >
          <mat-option value="To Do">To Do</mat-option>
          <mat-option value="In Progress">In Progress</mat-option>
          <mat-option value="In Review">In Review</mat-option>
          <mat-option value="Completed">Completed</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Category</mat-label>
        <input
          matInput
          [(ngModel)]="task.category"
          name="category"
          required
          aria-label="Task category"
        />
      </mat-form-field>
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Tags (comma-separated)</mat-label>
        <input
          matInput
          [(ngModel)]="tagsInput"
          name="tags"
          (ngModelChange)="updateTags()"
          aria-label="Task tags"
        />
      </mat-form-field>
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Assigned To</mat-label>
        <mat-select
          [(ngModel)]="task.assignedTo"
          name="assignedTo"
          required
          aria-label="Assigned to"
        >
          <mat-option
            *ngFor="let member of teamMembers$ | async"
            [value]="member.name"
          >
            {{ member.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div class="custom-form-field">
        <mat-label>Attachments</mat-label>
        <input
          type="file"
          (change)="handleFileInput($event)"
          multiple
          style="display: block"
          aria-label="Upload attachments"
        />
      </div>
      <div *ngIf="task.attachments.length > 0" class="attachment-list">
        <h4>Attached Files:</h4>
        <ul>
          <li *ngFor="let attachment of task.attachments">
            {{ attachment.name }} ({{ attachment.size | number }} bytes)
            <button
              mat-icon-button
              (click)="removeAttachment(attachment)"
              aria-label="Remove attachment"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </li>
        </ul>
      </div>
    </form>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-button (click)="onCancel()" aria-label="Cancel">Cancel</button>
    <button
      mat-button
      [disabled]="!taskForm.valid"
      (click)="onSave()"
      aria-label="Save task"
    >
      Save
    </button>
  </mat-dialog-actions>
</div>
